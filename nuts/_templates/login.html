<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="robots" content="noindex, nofollow" />

	<title>{CONST::APP_TITLE} - Login</title>
	<link rel="stylesheet" type="text/css" href="css/style.css" />

    <style type="text/css">
    body
    {
        background: none;
        background-image: none!important;
        background-color: #e5e5e5;
    }
    </style>

	<link rel="stylesheet" type="text/css" href="css/custom.css" />

	<link rel="icon" href="favicon.ico" />

	<script language="javascript" src="../library/js/php.js"></script>
	<script language="javascript" src="nuts.js"></script>


	<!-- ui -->
	<script src="../library/js/jquery.js"  type="text/javascript"></script>
	<script src="../library/js/jquery.form.js"  type="text/javascript"></script>
	<script src="../library/js/jquery-ui/jquery-ui-personalized-1.5.1.js" type="text/javascript"></script>
	<link rel="stylesheet" href="../library/js/jquery-ui/themes/custom/jquery-ui-themeroller.css" />

	<script src="../library/js/jquery.cookie.js"  type="text/javascript"></script>
	<script type="text/javascript">rememberMe(-1, '');</script>
	<!-- ui -->





</head>

<body>


<div id="content">
<!-- ajax::content -->

	<!-- login -->
	<form id="former" name="former" method="post" onsubmit="return xLogin(); ">

     <div id="login">

        <div id="login_title">{$nuts_login_lang_msg[0]}</div>

         <p class="error"><img src="img/icon-error.gif" align="absmiddle" /> {$nuts_login_lang_msg[3]}<br />&nbsp;</p>

		<bloc::failed>
		    <p class="error ip_blocked">
                <img src="img/icon-error.gif" align="absmiddle" />  {$nuts_lang_msg[55]}
            </p>
		</bloc::failed>

		<bloc::submit>
		<p class="login_p">
			<label>{$nuts_login_lang_msg[1]}</label>
			<input type="text" name="NutsLogin" id="NutsLogin" value="" autocomplete="on" />
		</p>
		<p class="login_p">
			<label>{$nuts_login_lang_msg[2]}</label>
			<input type="password" name="NutsPassword" id="NutsPassword" value="" autocomplete="on" />
			<input type="hidden" name="redirect_index" id="redirect_index" value="0"  autocomplete="off" />
		</p>

		<p>
			<label>&nbsp; </label>
			<input type="checkbox" name="Remember" id="Remember" value="1" /> <label id="label_Remember" for="Remember">{$nuts_login_lang_msg[4]}</label>

            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

            <input type="submit" value="Login" id="btn_submit" />

		</p>

		<p class="bottom">
            <a tabindex="-1" href="javascript:lostPassword();">{$nuts_lang_msg[44]}</a>

		</p>
		</bloc::submit>

         <div id="ip_current">IP : {IP}</div>

	</div>

	</form>
	<!-- login -->



<!-- /ajax::content -->
</div>

<script>

    var original__error_message = $('p.error').eq(0).html();
	$('#NutsLogin').focus();

    // error different
    if("{$_GET['error']}" == 'ip_different')
    {
        msg = "{$nuts_lang_msg[92]}<br/><br/>";
        $('p.error').eq(0).html(msg);
        $('p.error').eq(0).slideDown('normal');
    }

	function xLogin()
	{
		$('#redirect_index').val(0);

		// $('#btn_submit').attr('value', "{$nuts_lang_msg[23]}");
	 	$('#btn_submit').attr("disabled", true);
		$('#content').fadeTo(0, 0.33);

		f_serialized = $('#former').serializeArray();

		$.post('login.php', f_serialized, function(responseText){
			resp = responseText;
			resp = jQuery.trim(resp);

			if(resp == 'error_security')
			{
				document.location.href = "login.php";
			}

			if(resp != '')
			{
				$('p.error').eq(0).html(original__error_message);
				$('p.error').eq(0).slideDown('fast');
				$('#content').fadeTo(0.33, 1);
				//$('#btn_submit').attr('value', "{$nuts_lang_msg[56]}");
				$('#btn_submit').removeAttr("disabled");

				$('#NutsPassword').val('');
				$('#NutsPassword').focus();

			}
			else
			{
				$('p.error').eq(0).slideUp('fast');
				if($('#Remember').attr('checked') == true)
				{
					rememberMe($('#NutsLogin').val(), $('#NutsPassword').val());
				}

				$('#redirect_index').val(1);
				$('#former').attr('onsubmit', '');
				$('#former').submit();
			}
		});

		if($('#redirect_index').val() == 1)
			return true;
		else
			return false;
	}
	</script>


<!-- bottom -->
<div id="bottom">

	<bloc::trademark>
	Nuts&#8482; CMS {$nuts_lang_msg[42]} <a href="http://www.nuts-cms.com" target="_blank">official website</a>
	</bloc::trademark>

</div>
<!-- bottom -->

<!-- form window -->
<div id="form_window_lp">

	<div id="lp_error"><img src="img/icon-error.gif" align="absmiddle" /> {$nuts_lang_msg[46]}</div>
	<div id="lp_error_mail"><img src="img/icon-error.gif" align="absmiddle" /></div>
	<div id="lp_ok"><img src="img/icon-accept.gif" align="absmiddle" /> {$nuts_lang_msg[47]}</div>

	<form id="former_lp" name="former_lp" method="post">
	<p>
		<label>{$nuts_lang_msg[45]}</label>
		<input type="text" name="Email" id="Email" value="" style="width:250px;" />
		<input type="submit" value="{$nuts_lang_msg[56]}" id="btn_submit_lp" class="button" />
	</p>
	<input type="hidden" name="from" value="lp" />
	</form>

</div>
<script>
function lostPasswordInit()
{
	$("#form_window_lp").dialog({
				width:520,
				height:150,
				modal: true,
				title: "{$nuts_lang_msg[44]}",
				resizable: false,
				autoOpen: false,
				position: ['center', 'center'],
				overlay: {
					opacity: 0.3,
					background: "black"
				}
			});
}

function lostPassword()
{
	// reset fields !
    $('#lp_error, #lp_error_mail, #lp_ok').hide();
	$('#former_lp').show();

	$('#Email').val('');
	$('#btn_submit_lp').show();
	$('#btn_submit_lp').attr('value', "{$nuts_lang_msg[56]}");
	$('#btn_submit_lp').removeAttr("disabled");

	$("#form_window_lp").dialog("open");


}

$("#form_window_lp" ).bind( "dialogcreate", function(event, ui) {
    $('#former_lp #Email').focus();
});

lostPasswordInit();

var options = {
	target:        '',   // target element(s) to be updated with server response
	beforeSubmit:  showRequest2,  // pre-submit callback
	success:       showResponse2  // post-submit callback
};



function showRequest2(formData, jqForm, options)
{
	var queryString = $.param(formData);
	$('#btn_submit_lp').attr('value', "{$nuts_lang_msg[56]}");
	$('#btn_submit_lp').attr("disabled", true);

    $('#lp_error, #lp_error_mail, #lp_ok').hide();
	return true;
}

function showResponse2(responseText, statusText)
{
	resp = responseText;
	resp = jQuery.trim(resp);

	$('#btn_submit_lp').attr('value', "{$nuts_lang_msg[56]}");
 	$('#btn_submit_lp').removeAttr("disabled");

	if(resp == 'ok')
	{
		$('#former_lp').hide();
		$('#lp_ok').css("text-align", 'center')
				   .css("padding-top", '20px')
				   .css("padding-bottom", '20px')
				   .css("margin-top", '20px')
				   .slideDown('normal');
	}
	else if(resp.indexOf('error_mail;') == 0)
    {
        msg = str_replace('error_mail;', '', resp);

        $('#lp_error_mail').html(msg);
        $('#lp_error_mail').slideDown('normal');
    }
    else
    {
        $('#lp_error').slideDown('normal');
    }
}

// bind form using 'ajaxForm'
$('#former_lp').ajaxForm(options);



</script>
<!-- form window -->



<!-- google frame  -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"> </script>
<div id="placeholder"></div>
<script type="text/javascript">
 CFInstall.check({
    node: "placeholder",
    destination: "{CONST::WEBSITE_URL}/nuts/",
	cssText: "border:3px solid #ccc; padding:2px;"
  });
</script>
<!-- /google frame -->




</body>
</html>